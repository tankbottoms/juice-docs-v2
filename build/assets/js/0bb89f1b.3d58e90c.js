"use strict";(self.webpackChunkjuice_docs_v_2=self.webpackChunkjuice_docs_v_2||[]).push([[24895],{3905:(e,t,a)=>{a.d(t,{Zo:()=>p,kt:()=>u});var r=a(67294);function n(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){n(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function c(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var s=r.createContext({}),l=function(e){var t=r.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},p=function(e){var t=l(e.components);return r.createElement(s.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var a=e.components,n=e.mdxType,o=e.originalType,s=e.parentName,p=c(e,["components","mdxType","originalType","parentName"]),d=l(a),u=n,f=d["".concat(s,".").concat(u)]||d[u]||m[u]||o;return a?r.createElement(f,i(i({ref:t},p),{},{components:a})):r.createElement(f,i({ref:t},p))}));function u(e,t){var a=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var o=a.length,i=new Array(o);i[0]=d;var c={};for(var s in t)hasOwnProperty.call(t,s)&&(c[s]=t[s]);c.originalType=e,c.mdxType="string"==typeof e?e:n,i[1]=c;for(var l=2;l<o;l++)i[l]=a[l];return r.createElement.apply(null,i)}return r.createElement.apply(null,a)}d.displayName="MDXCreateElement"},64203:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>s,contentTitle:()=>i,default:()=>m,frontMatter:()=>o,metadata:()=>c,toc:()=>l});var r=a(87462),n=(a(67294),a(3905));const o={sidebar_position:2},i="Architecture",c={unversionedId:"dev/learn/architecture",id:"dev/learn/architecture",title:"Architecture",description:"The protocol is made up of 7 core contracts and 3 surface contracts.",source:"@site/docs/dev/learn/architecture.md",sourceDirName:"dev/learn",slug:"/dev/learn/architecture",permalink:"/dev/learn/architecture",draft:!1,editUrl:"https://github.com/jbx-protocol/juice-docs-v2/blob/main/docs/dev/learn/architecture.md",tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2},sidebar:"dev",previous:{title:"Overview",permalink:"/dev/learn/overview"},next:{title:"Administration",permalink:"/dev/learn/administration"}},s={},l=[{value:"Core contracts",id:"core-contracts",level:4},{value:"Surface contracts",id:"surface-contracts",level:4},{value:"Bonus utility contracts",id:"bonus-utility-contracts",level:4}],p={toc:l};function m(e){let{components:t,...a}=e;return(0,n.kt)("wrapper",(0,r.Z)({},p,a,{components:t,mdxType:"MDXLayout"}),(0,n.kt)("h1",{id:"architecture"},"Architecture"),(0,n.kt)("p",null,"The protocol is made up of 7 core contracts and 3 surface contracts."),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"Core contracts store all the independent components that make the protocol work."),(0,n.kt)("li",{parentName:"ul"},"Surface contracts glue core contracts together and manage funds. Anyone can write new surface contracts for projects to use.")),(0,n.kt)("h4",{id:"core-contracts"},"Core contracts"),(0,n.kt)("p",null,"The first two core contracts are self explanatory. They store the core opinionated components of the protocol."),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/dev/api/contracts/jbtokenstore/"},(0,n.kt)("inlineCode",{parentName:"a"},"JBTokenStore"))," manages token minting and burning for all projects."),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/dev/api/contracts/jbfundingcyclestore/"},(0,n.kt)("inlineCode",{parentName:"a"},"JBFundingCycleStore"))," manages funding cycle configurations and scheduling. Funding cycles are represented as a ",(0,n.kt)("a",{parentName:"li",href:"/dev/api/data-structures/jbfundingcycle"},(0,n.kt)("inlineCode",{parentName:"a"},"JBFundingCycle"))," data structure.")),(0,n.kt)("p",null,"The next few are a little more generic. They don't know anything specific to the ecosystem, and are open for use by other protocols or future extensions."),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},(0,n.kt)("a",{parentName:"p",href:"/dev/api/contracts/jbprojects/"},(0,n.kt)("inlineCode",{parentName:"a"},"JBProjects"))," manages and tracks ownership over projects, which are represented as ERC-721 tokens."),(0,n.kt)("p",{parentName:"li"},"The protocol uses this to enforce permissions needed to access several project-oriented transactions.")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},(0,n.kt)("a",{parentName:"p",href:"/dev/api/contracts/jbsplitsstore/"},(0,n.kt)("inlineCode",{parentName:"a"},"JBSplitsStore"))," stores information about how arbitrary distributions should be split. The information is represented as a ",(0,n.kt)("a",{parentName:"p",href:"/dev/api/data-structures/jbsplit"},(0,n.kt)("inlineCode",{parentName:"a"},"JBSplit"))," data structure."),(0,n.kt)("p",{parentName:"li"},"The surface contracts currently use these to split up payout distributions and reserved token distributions.")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},(0,n.kt)("a",{parentName:"p",href:"/dev/api/contracts/jbprices/"},(0,n.kt)("inlineCode",{parentName:"a"},"JBPrices"))," manages and normalizes price feeds of various currencies."),(0,n.kt)("p",{parentName:"li"},"The protocol uses this to allow projects to do their accounting in any number of currencies, but manage all funds in ETH or other assets regardless of accounting denomination.")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},(0,n.kt)("a",{parentName:"p",href:"/dev/api/contracts/jboperatorstore/"},(0,n.kt)("inlineCode",{parentName:"a"},"JBOperatorStore"))," stores operator permissions for all addresses. Addresses can give permissions to any other address to take specific indexed actions on their behalf, while confining the permissions to an arbitrary number of domain namespaces."),(0,n.kt)("p",{parentName:"li"},"The protocol uses this to allow project owners and token holders to give other EOAs or contracts permission to take certain administrative actions on their behalf. This is useful for encouraging a composable ecosystem where proxy contracts can perform actions on an address's behalf as a lego block.")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},(0,n.kt)("a",{parentName:"p",href:"/dev/api/contracts/jbdirectory/"},(0,n.kt)("inlineCode",{parentName:"a"},"JBDirectory"))," keeps a reference of which terminal contracts each project is currently accepting funds through, and which controller contract is managing each project's tokens and funding cycles."))),(0,n.kt)("h4",{id:"surface-contracts"},"Surface contracts"),(0,n.kt)("p",null,"There are currently 3 surface contracts that manage how projects manage funds and define how all core contracts should be used together. Anyone can write new surface contracts for projects to use."),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/dev/api/contracts/or-controllers/jbcontroller/"},(0,n.kt)("inlineCode",{parentName:"a"},"JBController"))," stitches together funding cycles and project tokens, allowing for restricted control, accounting, and token management."),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/dev/api/contracts/or-payment-terminals/or-abstract/jbpayoutredemptionpaymentterminal/"},(0,n.kt)("inlineCode",{parentName:"a"},"JBPayoutRedemptionPaymentTerminal"))," manages all inflows (",(0,n.kt)("a",{parentName:"li",href:"/dev/api/contracts/or-payment-terminals/or-abstract/jbpayoutredemptionpaymentterminal/write/pay"},(0,n.kt)("inlineCode",{parentName:"a"},"pay")),", ",(0,n.kt)("a",{parentName:"li",href:"/dev/api/contracts/or-payment-terminals/or-abstract/jbpayoutredemptionpaymentterminal/write/addtobalanceof"},(0,n.kt)("inlineCode",{parentName:"a"},"addToBalanceOf")),") and outflows (",(0,n.kt)("a",{parentName:"li",href:"/dev/api/contracts/or-payment-terminals/or-abstract/jbpayoutredemptionpaymentterminal/write/distributepayoutsof"},(0,n.kt)("inlineCode",{parentName:"a"},"distributePayoutsOf")),", ",(0,n.kt)("a",{parentName:"li",href:"/dev/api/contracts/or-payment-terminals/or-abstract/jbpayoutredemptionpaymentterminal/write/useallowanceof"},(0,n.kt)("inlineCode",{parentName:"a"},"useAllowanceOf")),", ",(0,n.kt)("a",{parentName:"li",href:"/dev/api/contracts/or-payment-terminals/or-abstract/jbpayoutredemptionpaymentterminal/write/redeemtokensof"},(0,n.kt)("inlineCode",{parentName:"a"},"redeemTokensOf")),") of funds. This is an abstract implementation that can be used by any number of payment terminals, such as ",(0,n.kt)("a",{parentName:"li",href:"/dev/api/contracts/or-payment-terminals/jbethpaymentterminal/"},(0,n.kt)("inlineCode",{parentName:"a"},"JBETHPaymentTerminal")),"'s and ",(0,n.kt)("a",{parentName:"li",href:"/dev/api/contracts/or-payment-terminals/jberc20paymentterminal/"},(0,n.kt)("inlineCode",{parentName:"a"},"JBERC20PaymentTerminal")),"'s."),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/dev/api/contracts/jbsingletokenpaymentterminalstore/"},(0,n.kt)("inlineCode",{parentName:"a"},"JBSingleTokenPaymentTerminalStore"))," manages accounting data on behalf of payment terminals that manage balances of only one token type.")),(0,n.kt)("p",null,"The abstract ",(0,n.kt)("a",{parentName:"p",href:"/dev/api/contracts/or-payment-terminals/or-abstract/jbpayoutredemptionpaymentterminal/"},(0,n.kt)("inlineCode",{parentName:"a"},"JBPayoutRedemptionPaymentTerminal"))," implements the ",(0,n.kt)("a",{parentName:"p",href:"/dev/api/interfaces/ijbpaymentterminal"},(0,n.kt)("inlineCode",{parentName:"a"},"IJBPaymentTerminal"))," interface to provide outflow mechanics, and ",(0,n.kt)("a",{parentName:"p",href:"/dev/api/contracts/or-payment-terminals/jbethpaymentterminal/"},(0,n.kt)("inlineCode",{parentName:"a"},"JBETHPaymentTerminal"))," and ",(0,n.kt)("a",{parentName:"p",href:"/dev/api/contracts/or-payment-terminals/jberc20paymentterminal/"},(0,n.kt)("inlineCode",{parentName:"a"},"JBERC20PaymentTerminal"))," in-turn extend the ",(0,n.kt)("a",{parentName:"p",href:"/dev/api/contracts/or-payment-terminals/or-abstract/jbpayoutredemptionpaymentterminal/"},(0,n.kt)("inlineCode",{parentName:"a"},"JBPayoutRedemptionPaymentTerminal"))," to provide scoped inflow/outflow environments for specific tokens. Projects are welcome to roll their own ",(0,n.kt)("a",{parentName:"p",href:"/dev/api/interfaces/ijbpaymentterminal"},(0,n.kt)("inlineCode",{parentName:"a"},"IJBPaymentTerminal"))," implementations to accept funds through. This can be useful to accept other tokens as payment, bypass protocol fees, or attempt some other funky design. A project can add/remove terminals from the core ",(0,n.kt)("a",{parentName:"p",href:"/dev/api/contracts/jbdirectory/"},(0,n.kt)("inlineCode",{parentName:"a"},"JBDirectory"))," contract using ",(0,n.kt)("a",{parentName:"p",href:"/dev/api/contracts/jbdirectory/write/setterminalsof"},(0,n.kt)("inlineCode",{parentName:"a"},"JBDirectory.setTerminalsOf(...)"))," if its current funding cycle is configured to allow doing so."),(0,n.kt)("p",null,"Likewise, a project can bring its own contract to serve as its controller. A project's controller is the only contract that has direct access to manipulate its tokens and funding cycles. A project can set its controller from the core ",(0,n.kt)("a",{parentName:"p",href:"/dev/api/contracts/jbdirectory/"},(0,n.kt)("inlineCode",{parentName:"a"},"JBDirectory"))," contract using ",(0,n.kt)("a",{parentName:"p",href:"/dev/api/contracts/jbdirectory/write/setcontrollerof"},(0,n.kt)("inlineCode",{parentName:"a"},"JBDirectory.setControllerOf(...)"))," if its current funding cycle is configured to allow doing so."),(0,n.kt)("h4",{id:"bonus-utility-contracts"},"Bonus utility contracts"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/dev/api/contracts/or-utilities/jbetherc20projectpayer/"},(0,n.kt)("inlineCode",{parentName:"a"},"JBETHERC20ProjectPayer"))," provides utilities to pay a project. Inheriting this contract is useful for contracts that wish to route funds to a treasury while specifying the token beneficiary, memo, and other contextual information alongside. Instances of this contract can also be deployed as stand-alone addresses that will forward funds received directly to a project's treasury."),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/dev/api/contracts/or-utilities/jbetherc20projectpayerdeployer/"},(0,n.kt)("inlineCode",{parentName:"a"},"JBETHERC20ProjectPayerDeployer"))," provides a function to deploy new stand-alone ",(0,n.kt)("a",{parentName:"li",href:"/dev/api/contracts/or-utilities/jbetherc20projectpayer/"},(0,n.kt)("inlineCode",{parentName:"a"},"JBETHERC20ProjectPayer")),"s. "),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/dev/api/contracts/or-utilities/jbetherc20splitspayer/"},(0,n.kt)("inlineCode",{parentName:"a"},"JBETHERC20SplitsPayer"))," provides utilities to pay a group of splits. Inheriting this contract is useful for contracts that wish to route funds to a group of splits while specifying contextual information alongside. Instances of this contract can also be deployed as stand-alone addresses that will forward funds received directly to a group of splits."),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/dev/api/contracts/or-utilities/jbetherc20splitspayerdeployer/"},(0,n.kt)("inlineCode",{parentName:"a"},"JBETHERC20SplitsPayerDeployer"))," provides a function to deploy new stand-alone ",(0,n.kt)("a",{parentName:"li",href:"/dev/api/contracts/or-utilities/jbetherc20splitspayer/"},(0,n.kt)("inlineCode",{parentName:"a"},"JBETHERC20SplitsPayer")),"s. "),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/dev/api/contracts/or-utilities/jbprojecthandles/"},(0,n.kt)("inlineCode",{parentName:"a"},"JBProjectHandles"))," lets project owners attach an ENS name as a project handle. Front ends can use a project's handle in place of its project ID, and indexers can use events to make the Juicebox project directory searchable and filterable. ")))}m.isMDXComponent=!0}}]);