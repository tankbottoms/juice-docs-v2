"use strict";(self.webpackChunkjuice_docs_v_2=self.webpackChunkjuice_docs_v_2||[]).push([[4085],{3905:(e,t,n)=>{n.d(t,{Zo:()=>s,kt:()=>p});var r=n(67294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var u=r.createContext({}),m=function(e){var t=r.useContext(u),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},s=function(e){var t=m(e.components);return r.createElement(u.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,i=e.originalType,u=e.parentName,s=o(e,["components","mdxType","originalType","parentName"]),d=m(n),p=a,k=d["".concat(u,".").concat(p)]||d[p]||c[p]||i;return n?r.createElement(k,l(l({ref:t},s),{},{components:n})):r.createElement(k,l({ref:t},s))}));function p(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=n.length,l=new Array(i);l[0]=d;var o={};for(var u in t)hasOwnProperty.call(t,u)&&(o[u]=t[u]);o.originalType=e,o.mdxType="string"==typeof e?e:a,l[1]=o;for(var m=2;m<i;m++)l[m]=n[m];return r.createElement.apply(null,l)}return r.createElement.apply(null,n)}d.displayName="MDXCreateElement"},85162:(e,t,n)=>{n.d(t,{Z:()=>l});var r=n(67294),a=n(86010);const i="tabItem_Ymn6";function l(e){let{children:t,hidden:n,className:l}=e;return r.createElement("div",{role:"tabpanel",className:(0,a.Z)(i,l),hidden:n},t)}},65488:(e,t,n)=>{n.d(t,{Z:()=>p});var r=n(87462),a=n(67294),i=n(86010),l=n(72389),o=n(67392),u=n(7094),m=n(12466);const s="tabList__CuJ",c="tabItem_LNqP";function d(e){var t,n;const{lazy:l,block:d,defaultValue:p,values:k,groupId:f,className:b}=e,N=a.Children.map(e.children,(e=>{if((0,a.isValidElement)(e)&&"value"in e.props)return e;throw new Error("Docusaurus error: Bad <Tabs> child <"+("string"==typeof e.type?e.type:e.type.name)+'>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.')})),h=null!=k?k:N.map((e=>{let{props:{value:t,label:n,attributes:r}}=e;return{value:t,label:n,attributes:r}})),y=(0,o.l)(h,((e,t)=>e.value===t.value));if(y.length>0)throw new Error('Docusaurus error: Duplicate values "'+y.map((e=>e.value)).join(", ")+'" found in <Tabs>. Every value needs to be unique.');const g=null===p?p:null!=(t=null!=p?p:null==(n=N.find((e=>e.props.default)))?void 0:n.props.value)?t:N[0].props.value;if(null!==g&&!h.some((e=>e.value===g)))throw new Error('Docusaurus error: The <Tabs> has a defaultValue "'+g+'" but none of its children has the corresponding value. Available values are: '+h.map((e=>e.value)).join(", ")+". If you intend to show no default tab, use defaultValue={null} instead.");const{tabGroupChoices:T,setTabGroupChoices:_}=(0,u.U)(),[v,I]=(0,a.useState)(g),C=[],{blockElementScrollPositionUntilNextRender:O}=(0,m.o5)();if(null!=f){const e=T[f];null!=e&&e!==v&&h.some((t=>t.value===e))&&I(e)}const j=e=>{const t=e.currentTarget,n=C.indexOf(t),r=h[n].value;r!==v&&(O(t),I(r),null!=f&&_(f,String(r)))},w=e=>{var t;let n=null;switch(e.key){case"ArrowRight":{var r;const t=C.indexOf(e.currentTarget)+1;n=null!=(r=C[t])?r:C[0];break}case"ArrowLeft":{var a;const t=C.indexOf(e.currentTarget)-1;n=null!=(a=C[t])?a:C[C.length-1];break}}null==(t=n)||t.focus()};return a.createElement("div",{className:(0,i.Z)("tabs-container",s)},a.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,i.Z)("tabs",{"tabs--block":d},b)},h.map((e=>{let{value:t,label:n,attributes:l}=e;return a.createElement("li",(0,r.Z)({role:"tab",tabIndex:v===t?0:-1,"aria-selected":v===t,key:t,ref:e=>C.push(e),onKeyDown:w,onFocus:j,onClick:j},l,{className:(0,i.Z)("tabs__item",c,null==l?void 0:l.className,{"tabs__item--active":v===t})}),null!=n?n:t)}))),l?(0,a.cloneElement)(N.filter((e=>e.props.value===v))[0],{className:"margin-top--md"}):a.createElement("div",{className:"margin-top--md"},N.map(((e,t)=>(0,a.cloneElement)(e,{key:t,hidden:e.props.value!==v})))))}function p(e){const t=(0,l.Z)();return a.createElement(d,(0,r.Z)({key:String(t)},e))}},60368:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>u,default:()=>p,frontMatter:()=>o,metadata:()=>m,toc:()=>c});var r=n(87462),a=(n(67294),n(3905)),i=n(65488),l=n(85162);const o={},u="recordDistributionFor",m={unversionedId:"dev/api/contracts/jbsingletokenpaymentterminalstore/write/recorddistributionfor",id:"dev/api/contracts/jbsingletokenpaymentterminalstore/write/recorddistributionfor",title:"recordDistributionFor",description:"Contract: JBSingleTokenPaymentTerminalStore\u200b\u200c",source:"@site/docs/dev/api/contracts/jbsingletokenpaymentterminalstore/write/recorddistributionfor.md",sourceDirName:"dev/api/contracts/jbsingletokenpaymentterminalstore/write",slug:"/dev/api/contracts/jbsingletokenpaymentterminalstore/write/recorddistributionfor",permalink:"/dev/api/contracts/jbsingletokenpaymentterminalstore/write/recorddistributionfor",draft:!1,editUrl:"https://github.com/jbx-protocol/juice-docs-v2/blob/main/docs/dev/api/contracts/jbsingletokenpaymentterminalstore/write/recorddistributionfor.md",tags:[],version:"current",frontMatter:{},sidebar:"dev",previous:{title:"recordAddedBalanceFor",permalink:"/dev/api/contracts/jbsingletokenpaymentterminalstore/write/recordaddedbalancefor"},next:{title:"recordMigration",permalink:"/dev/api/contracts/jbsingletokenpaymentterminalstore/write/recordmigration"}},s={},c=[{value:"Definition",id:"definition",level:4},{value:"Body",id:"body",level:4}],d={toc:c};function p(e){let{components:t,...n}=e;return(0,a.kt)("wrapper",(0,r.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"recorddistributionfor"},"recordDistributionFor"),(0,a.kt)("p",null,"Contract: ",(0,a.kt)("a",{parentName:"p",href:"/dev/api/jbdirectory/write/"},(0,a.kt)("inlineCode",{parentName:"a"},"JBSingleTokenPaymentTerminalStore")),"\u200b\u200c"),(0,a.kt)("p",null,"Interface: ",(0,a.kt)("a",{parentName:"p",href:"/dev/api/interfaces/ijbsingletokenpaymentterminalstore"},(0,a.kt)("inlineCode",{parentName:"a"},"IJBSingleTokenPaymentTerminalStore"))),(0,a.kt)(i.Z,{mdxType:"Tabs"},(0,a.kt)(l.Z,{value:"Step by step",label:"Step by step",mdxType:"TabItem"},(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Records newly distributed funds for a project.")),(0,a.kt)("p",null,(0,a.kt)("em",{parentName:"p"},"The msg.sender must be an ",(0,a.kt)("a",{parentName:"em",href:"/dev/api/interfaces/ijbpaymentterminal"},(0,a.kt)("inlineCode",{parentName:"a"},"IJBSingleTokenPaymentTerminal")),".")),(0,a.kt)("h4",{id:"definition"},"Definition"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"function recordDistributionFor(\n  uint256 _projectId,\n  uint256 _amount,\n  uint256 _currency\n)\n  external\n  override\n  nonReentrant\n  returns (JBFundingCycle memory fundingCycle, uint256 distributedAmount) { ... }\n")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Arguments:",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"_projectId")," is the ID of the project that is having funds distributed."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"_amount")," is the amount to use from the distribution limit, as a fixed point number."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"_currency")," is the currency of the ",(0,a.kt)("inlineCode",{parentName:"li"},"_amount"),". This must match the project's current funding cycle's currency."))),(0,a.kt)("li",{parentName:"ul"},"The resulting function overrides a function definition from the ",(0,a.kt)("a",{parentName:"li",href:"/dev/api/interfaces/ijbsingletokenpaymentterminalstore"},(0,a.kt)("inlineCode",{parentName:"a"},"JBSingleTokenPaymentTerminalStore"))," interface."),(0,a.kt)("li",{parentName:"ul"},"The function returns:",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"fundingCycle")," is the funding cycle during which the withdrawal was made."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"distributedAmount")," is the amount of terminal tokens distributed, as a fixed point number with the same amount of decimals as its relative terminal.")))),(0,a.kt)("h4",{id:"body"},"Body"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Get a reference to the project's current funding cycle."),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre"},"// Get a reference to the project's current funding cycle.\nfundingCycle = fundingCycleStore.currentOf(_projectId);\n")),(0,a.kt)("p",{parentName:"li"},(0,a.kt)("em",{parentName:"p"},"External references:")),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"/dev/api/contracts/jbfundingcyclestore/read/currentof"},(0,a.kt)("inlineCode",{parentName:"a"},"currentOf"))))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Make sure the current funding cycle doesn't have distributions paused."),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre"},"// The funding cycle must not be configured to have distributions paused.\nif (fundingCycle.distributionsPaused()) revert FUNDING_CYCLE_DISTRIBUTION_PAUSED();\n")),(0,a.kt)("p",{parentName:"li"},(0,a.kt)("em",{parentName:"p"},"Library references:")),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"/dev/api/libraries/jbfundingcyclemetadataresolver"},(0,a.kt)("inlineCode",{parentName:"a"},"JBFundingCycleMetadataResolver")),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},".distributionsPaused(...)")))))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Calculate the new total amount that has been distributed during this funding cycle by adding the amount being distributed to the used distribution limit."),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre"},"// The new total amount that has been distributed during this funding cycle.\nuint256 _newUsedDistributionLimitOf = usedDistributionLimitOf[\n  IJBSingleTokenPaymentTerminal(msg.sender)\n][_projectId][fundingCycle.number] + _amount;\n")),(0,a.kt)("p",{parentName:"li"},(0,a.kt)("em",{parentName:"p"},"Internal references:")),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"/dev/api/contracts/jbsingletokenpaymentterminalstore/properties/useddistributionlimitof"},(0,a.kt)("inlineCode",{parentName:"a"},"usedDistributionLimitOf"))))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Get a reference to the currrent distribution limit of the project during the current funding cycle, and the currency the distribution limit is in terms of."),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre"},"// Amount must be within what is still distributable.\n(uint256 _distributionLimitOf, uint256 _distributionLimitCurrencyOf) = IJBController(\n  directory.controllerOf(_projectId)\n).distributionLimitOf(\n    _projectId,\n    fundingCycle.configuration,\n    IJBSingleTokenPaymentTerminal(msg.sender),\n    IJBSingleTokenPaymentTerminal(msg.sender).token()\n  );\n")),(0,a.kt)("p",{parentName:"li"},(0,a.kt)("em",{parentName:"p"},"External references:")),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"/dev/api/contracts/or-controllers/jbcontroller/read/distributionlimitof"},(0,a.kt)("inlineCode",{parentName:"a"},"distributionLimitOf"))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"/dev/api/contracts/or-payment-terminals/or-abstract/jbsingletokenpaymentterminal/properties/token"},(0,a.kt)("inlineCode",{parentName:"a"},"token"))))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Make sure the new total amount distributed will be at most the distribution limit."),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre"},"// Make sure the new used amount is within the distribution limit.\nif (_newUsedDistributionLimitOf > _distributionLimitOf || _distributionLimitOf == 0)\n  revert DISTRIBUTION_AMOUNT_LIMIT_REACHED();\n"))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Make the sure the provided currency matches the expected currency for the distribution limit."),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre"},"// Make sure the currencies match.\nif (_currency != _distributionLimitCurrencyOf) revert CURRENCY_MISMATCH();\n"))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Get a reference to the terminal's currency."),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre"},"// Get a reference to the terminal's currency.\nuint256 _balanceCurrency = IJBSingleTokenPaymentTerminal(msg.sender).currency();\n"))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Calculate how much of the balance will be used. If the currency of the distribution limit and the balance are the same, no price conversion is necessary. Otherwise, convert the distribution limit currency to that of the balance. "),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre"},"// Convert the amount to the balance's currency.\ndistributedAmount = (_currency == _balanceCurrency) ? _amount : PRBMath\n  .mulDiv(\n    _amount,\n    10**_MAX_FIXED_POINT_FIDELITY, // Use _MAX_FIXED_POINT_FIDELITY to keep as much of the `_amount.value`'s fidelity as possible when converting.\n    prices.priceFor(_currency, _balanceCurrency, _MAX_FIXED_POINT_FIDELITY)\n  );\n")),(0,a.kt)("p",{parentName:"li"},(0,a.kt)("em",{parentName:"p"},"Library references:")),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://github.com/hifi-finance/prb-math/blob/main/contracts/PRBMath.sol"},(0,a.kt)("inlineCode",{parentName:"a"},"PRBMath")),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},".mulDiv(...)"))))),(0,a.kt)("p",{parentName:"li"},(0,a.kt)("em",{parentName:"p"},"Internal references:")),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"/dev/api/contracts/jbsingletokenpaymentterminalstore/properties/-_max_fixed_point_fidelity"},(0,a.kt)("inlineCode",{parentName:"a"},"_MAX_FIXED_POINT_FIDELITY")))),(0,a.kt)("p",{parentName:"li"},(0,a.kt)("em",{parentName:"p"},"External references:")),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"/dev/api/contracts/jbprices/read/pricefor"},(0,a.kt)("inlineCode",{parentName:"a"},"priceFor"))))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Make sure the project has access to the amount being distributed."),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre"},"// The amount being distributed must be available.\nif (distributedAmount > balanceOf[IJBSingleTokenPaymentTerminal(msg.sender)][_projectId])\n  revert INADEQUATE_PAYMENT_TERMINAL_STORE_BALANCE();\n")),(0,a.kt)("p",{parentName:"li"},(0,a.kt)("em",{parentName:"p"},"Internal references:")),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"/dev/api/contracts/jbsingletokenpaymentterminalstore/properties/balanceof"},(0,a.kt)("inlineCode",{parentName:"a"},"balanceOf"))))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Store the new used distributed amount."),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre"},"// Store the new amount.\nusedDistributionLimitOf[IJBSingleTokenPaymentTerminal(msg.sender)][_projectId][\n  fundingCycle.number\n] = _newUsedDistributionLimitOf;\n")),(0,a.kt)("p",{parentName:"li"},(0,a.kt)("em",{parentName:"p"},"Internal references:")),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"/dev/api/contracts/jbsingletokenpaymentterminalstore/properties/useddistributionlimitof"},(0,a.kt)("inlineCode",{parentName:"a"},"usedDistributionLimitOf"))))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Store the decremented balance."),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre"},"// Removed the distributed funds from the project's token balance.\nbalanceOf[IJBSingleTokenPaymentTerminal(msg.sender)][_projectId] =\n  balanceOf[IJBSingleTokenPaymentTerminal(msg.sender)][_projectId] -\n  distributedAmount;\n")),(0,a.kt)("p",{parentName:"li"},(0,a.kt)("em",{parentName:"p"},"Internal references:")),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"/dev/api/contracts/jbsingletokenpaymentterminalstore/properties/balanceof"},(0,a.kt)("inlineCode",{parentName:"a"},"balanceOf"))))))),(0,a.kt)(l.Z,{value:"Code",label:"Code",mdxType:"TabItem"},(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"/**\n  @notice\n  Records newly distributed funds for a project.\n\n  @dev\n  The msg.sender must be an IJBSingleTokenPaymentTerminal. \n\n  @param _projectId The ID of the project that is having funds distributed.\n  @param _amount The amount to use from the distribution limit, as a fixed point number.\n  @param _currency The currency of the `_amount`. This must match the project's current funding cycle's currency.\n\n  @return fundingCycle The funding cycle during which the distribution was made.\n  @return distributedAmount The amount of terminal tokens distributed, as a fixed point number with the same amount of decimals as its relative terminal.\n*/\nfunction recordDistributionFor(\n  uint256 _projectId,\n  uint256 _amount,\n  uint256 _currency,\n  uint256 _balanceCurrency\n)\n  external\n  override\n  nonReentrant\n  returns (JBFundingCycle memory fundingCycle, uint256 distributedAmount)\n{\n  // Get a reference to the project's current funding cycle.\n  fundingCycle = fundingCycleStore.currentOf(_projectId);\n\n  // The funding cycle must not be configured to have distributions paused.\n  if (fundingCycle.distributionsPaused()) revert FUNDING_CYCLE_DISTRIBUTION_PAUSED();\n\n  // The new total amount that has been distributed during this funding cycle.\n  uint256 _newUsedDistributionLimitOf = usedDistributionLimitOf[\n    IJBSingleTokenPaymentTerminal(msg.sender)\n  ][_projectId][fundingCycle.number] + _amount;\n\n  // Amount must be within what is still distributable.\n  (uint256 _distributionLimitOf, uint256 _distributionLimitCurrencyOf) = IJBController(\n    directory.controllerOf(_projectId)\n  ).distributionLimitOf(\n      _projectId,\n      fundingCycle.configuration,\n      IJBSingleTokenPaymentTerminal(msg.sender),\n      IJBSingleTokenPaymentTerminal(msg.sender).token()\n    );\n\n  // Make sure the new used amount is within the distribution limit.\n  if (_newUsedDistributionLimitOf > _distributionLimitOf || _distributionLimitOf == 0)\n    revert DISTRIBUTION_AMOUNT_LIMIT_REACHED();\n\n  // Make sure the currencies match.\n  if (_currency != _distributionLimitCurrencyOf) revert CURRENCY_MISMATCH();\n\n  // Get a reference to the terminal's currency.\n  uint256 _balanceCurrency = IJBSingleTokenPaymentTerminal(msg.sender).currency();\n\n  // Convert the amount to the balance's currency.\n  distributedAmount = (_currency == _balanceCurrency) ? _amount : PRBMath\n    .mulDiv(\n      _amount,\n      10**_MAX_FIXED_POINT_FIDELITY, // Use _MAX_FIXED_POINT_FIDELITY to keep as much of the `_amount.value`'s fidelity as possible when converting.\n      prices.priceFor(_currency, _balanceCurrency, _MAX_FIXED_POINT_FIDELITY)\n    );\n\n  // The amount being distributed must be available.\n  if (distributedAmount > balanceOf[IJBSingleTokenPaymentTerminal(msg.sender)][_projectId])\n    revert INADEQUATE_PAYMENT_TERMINAL_STORE_BALANCE();\n\n  // Store the new amount.\n  usedDistributionLimitOf[IJBSingleTokenPaymentTerminal(msg.sender)][_projectId][\n    fundingCycle.number\n  ] = _newUsedDistributionLimitOf;\n\n  // Removed the distributed funds from the project's token balance.\n  balanceOf[IJBSingleTokenPaymentTerminal(msg.sender)][_projectId] =\n    balanceOf[IJBSingleTokenPaymentTerminal(msg.sender)][_projectId] -\n    distributedAmount;\n}\n"))),(0,a.kt)(l.Z,{value:"Errors",label:"Errors",mdxType:"TabItem"},(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"String"),(0,a.kt)("th",{parentName:"tr",align:null},"Description"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("strong",{parentName:"td"},(0,a.kt)("inlineCode",{parentName:"strong"},"FUNDING_CYCLE_DISTRIBUTION_PAUSED"))),(0,a.kt)("td",{parentName:"tr",align:null},"Thrown if the project has configured its current funding cycle to pause distributions.")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("strong",{parentName:"td"},(0,a.kt)("inlineCode",{parentName:"strong"},"CURRENCY_MISMATCH"))),(0,a.kt)("td",{parentName:"tr",align:null},"Thrown if the currency of the specified amount doesn't match the currency of the project's current funding cycle.")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("strong",{parentName:"td"},(0,a.kt)("inlineCode",{parentName:"strong"},"DISTRIBUTION_AMOUNT_LIMIT_REACHED"))),(0,a.kt)("td",{parentName:"tr",align:null},"Thrown if there isn't enough of a distribution limit for the specified terminal to fulfill the desired distribution.")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("strong",{parentName:"td"},(0,a.kt)("inlineCode",{parentName:"strong"},"INADEQUATE_PAYMENT_TERMINAL_STORE_BALANCE"))),(0,a.kt)("td",{parentName:"tr",align:null},"Thrown if the project's balance isn't sufficient to fulfill the desired distribution.")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("strong",{parentName:"td"},(0,a.kt)("inlineCode",{parentName:"strong"},"INADEQUATE_WITHDRAW_AMOUNT"))),(0,a.kt)("td",{parentName:"tr",align:null},"Thrown if the distribution amount is less than the minimum expected."))))),(0,a.kt)(l.Z,{value:"Bug bounty",label:"Bug bounty",mdxType:"TabItem"},(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"Category"),(0,a.kt)("th",{parentName:"tr",align:null},"Description"),(0,a.kt)("th",{parentName:"tr",align:null},"Reward"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("strong",{parentName:"td"},"Optimization")),(0,a.kt)("td",{parentName:"tr",align:null},"Help make this operation more efficient."),(0,a.kt)("td",{parentName:"tr",align:null},"0.5ETH")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("strong",{parentName:"td"},"Low severity")),(0,a.kt)("td",{parentName:"tr",align:null},"Identify a vulnerability in this operation that could lead to an inconvenience for a user of the protocol or for a protocol developer."),(0,a.kt)("td",{parentName:"tr",align:null},"1ETH")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("strong",{parentName:"td"},"High severity")),(0,a.kt)("td",{parentName:"tr",align:null},"Identify a vulnerability in this operation that could lead to data corruption or loss of funds."),(0,a.kt)("td",{parentName:"tr",align:null},"5+ETH")))))))}p.isMDXComponent=!0}}]);