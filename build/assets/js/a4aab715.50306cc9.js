"use strict";(self.webpackChunkjuice_docs_v_2=self.webpackChunkjuice_docs_v_2||[]).push([[96632],{3905:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>p});var a=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},l=Object.keys(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var c=a.createContext({}),u=function(e){var t=a.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},d=function(e){var t=u(e.components);return a.createElement(c.Provider,{value:t},e.children)},s={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,l=e.originalType,c=e.parentName,d=o(e,["components","mdxType","originalType","parentName"]),m=u(n),p=r,f=m["".concat(c,".").concat(p)]||m[p]||s[p]||l;return n?a.createElement(f,i(i({ref:t},d),{},{components:n})):a.createElement(f,i({ref:t},d))}));function p(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var l=n.length,i=new Array(l);i[0]=m;var o={};for(var c in t)hasOwnProperty.call(t,c)&&(o[c]=t[c]);o.originalType=e,o.mdxType="string"==typeof e?e:r,i[1]=o;for(var u=2;u<l;u++)i[u]=n[u];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},85162:(e,t,n)=>{n.d(t,{Z:()=>i});var a=n(67294),r=n(86010);const l="tabItem_Ymn6";function i(e){let{children:t,hidden:n,className:i}=e;return a.createElement("div",{role:"tabpanel",className:(0,r.Z)(l,i),hidden:n},t)}},65488:(e,t,n)=>{n.d(t,{Z:()=>p});var a=n(87462),r=n(67294),l=n(86010),i=n(72389),o=n(67392),c=n(7094),u=n(12466);const d="tabList__CuJ",s="tabItem_LNqP";function m(e){var t,n;const{lazy:i,block:m,defaultValue:p,values:f,groupId:b,className:y}=e,h=r.Children.map(e.children,(e=>{if((0,r.isValidElement)(e)&&"value"in e.props)return e;throw new Error("Docusaurus error: Bad <Tabs> child <"+("string"==typeof e.type?e.type:e.type.name)+'>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.')})),g=null!=f?f:h.map((e=>{let{props:{value:t,label:n,attributes:a}}=e;return{value:t,label:n,attributes:a}})),k=(0,o.l)(g,((e,t)=>e.value===t.value));if(k.length>0)throw new Error('Docusaurus error: Duplicate values "'+k.map((e=>e.value)).join(", ")+'" found in <Tabs>. Every value needs to be unique.');const v=null===p?p:null!=(t=null!=p?p:null==(n=h.find((e=>e.props.default)))?void 0:n.props.value)?t:h[0].props.value;if(null!==v&&!g.some((e=>e.value===v)))throw new Error('Docusaurus error: The <Tabs> has a defaultValue "'+v+'" but none of its children has the corresponding value. Available values are: '+g.map((e=>e.value)).join(", ")+". If you intend to show no default tab, use defaultValue={null} instead.");const{tabGroupChoices:N,setTabGroupChoices:_}=(0,c.U)(),[C,w]=(0,r.useState)(v),F=[],{blockElementScrollPositionUntilNextRender:O}=(0,u.o5)();if(null!=b){const e=N[b];null!=e&&e!==C&&g.some((t=>t.value===e))&&w(e)}const j=e=>{const t=e.currentTarget,n=F.indexOf(t),a=g[n].value;a!==C&&(O(t),w(a),null!=b&&_(b,String(a)))},T=e=>{var t;let n=null;switch(e.key){case"ArrowRight":{var a;const t=F.indexOf(e.currentTarget)+1;n=null!=(a=F[t])?a:F[0];break}case"ArrowLeft":{var r;const t=F.indexOf(e.currentTarget)-1;n=null!=(r=F[t])?r:F[F.length-1];break}}null==(t=n)||t.focus()};return r.createElement("div",{className:(0,l.Z)("tabs-container",d)},r.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,l.Z)("tabs",{"tabs--block":m},y)},g.map((e=>{let{value:t,label:n,attributes:i}=e;return r.createElement("li",(0,a.Z)({role:"tab",tabIndex:C===t?0:-1,"aria-selected":C===t,key:t,ref:e=>F.push(e),onKeyDown:T,onFocus:j,onClick:j},i,{className:(0,l.Z)("tabs__item",s,null==i?void 0:i.className,{"tabs__item--active":C===t})}),null!=n?n:t)}))),i?(0,r.cloneElement)(h.filter((e=>e.props.value===C))[0],{className:"margin-top--md"}):r.createElement("div",{className:"margin-top--md"},h.map(((e,t)=>(0,r.cloneElement)(e,{key:t,hidden:e.props.value!==C})))))}function p(e){const t=(0,i.Z)();return r.createElement(m,(0,a.Z)({key:String(t)},e))}},77583:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>c,default:()=>p,frontMatter:()=>o,metadata:()=>u,toc:()=>s});var a=n(87462),r=(n(67294),n(3905)),l=n(65488),i=n(85162);const o={},c="_mockFundingCycleBasedOn",u={unversionedId:"dev/api/contracts/jbfundingcyclestore/read/-_mockfundingcyclebasedon",id:"dev/api/contracts/jbfundingcyclestore/read/-_mockfundingcyclebasedon",title:"_mockFundingCycleBasedOn",description:"Contract: JBFundingCycleStore\u200b",source:"@site/docs/dev/api/contracts/jbfundingcyclestore/read/-_mockfundingcyclebasedon.md",sourceDirName:"dev/api/contracts/jbfundingcyclestore/read",slug:"/dev/api/contracts/jbfundingcyclestore/read/-_mockfundingcyclebasedon",permalink:"/dev/api/contracts/jbfundingcyclestore/read/-_mockfundingcyclebasedon",draft:!1,editUrl:"https://github.com/jbx-protocol/juice-docs-v2/blob/main/docs/dev/api/contracts/jbfundingcyclestore/read/-_mockfundingcyclebasedon.md",tags:[],version:"current",frontMatter:{},sidebar:"dev",previous:{title:"_isApproved",permalink:"/dev/api/contracts/jbfundingcyclestore/read/-_isapproved"},next:{title:"_standbyOf",permalink:"/dev/api/contracts/jbfundingcyclestore/read/-_standbyof"}},d={},s=[{value:"Definition",id:"definition",level:4},{value:"Body",id:"body",level:4}],m={toc:s};function p(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,a.Z)({},m,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"_mockfundingcyclebasedon"},"_mockFundingCycleBasedOn"),(0,r.kt)("p",null,"Contract: ",(0,r.kt)("a",{parentName:"p",href:"/dev/api/contracts/jbfundingcyclestore/"},(0,r.kt)("inlineCode",{parentName:"a"},"JBFundingCycleStore")),"\u200b"),(0,r.kt)(l.Z,{mdxType:"Tabs"},(0,r.kt)(i.Z,{value:"Step by step",label:"Step by step",mdxType:"TabItem"},(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"A view of the funding cycle that would be created based on the provided one if the project doesn't make a reconfiguration.")),(0,r.kt)("p",null,(0,r.kt)("em",{parentName:"p"},"Returns an empty funding cycle if there can't be a mock funding cycle based on the provided one.")),(0,r.kt)("p",null,(0,r.kt)("em",{parentName:"p"},"Assumes a funding cycle with a duration of 0 will never be asked to be the base of a mock.")),(0,r.kt)("h4",{id:"definition"},"Definition"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"function _mockFundingCycleBasedOn(JBFundingCycle memory _baseFundingCycle, bool _allowMidCycle)\n  private\n  view\n  returns (JBFundingCycle memory) { ... }\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Arguments:",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"_baseFundingCycle")," is the ",(0,r.kt)("a",{parentName:"li",href:"/dev/api/data-structures/jbfundingcycle"},(0,r.kt)("inlineCode",{parentName:"a"},"JBFundingCycle"))," that the resulting funding cycle should follow."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"_allowMidCycle")," is a flag indicating if the mocked funding cycle is allowed to already be mid cycle."))),(0,r.kt)("li",{parentName:"ul"},"The view function is private to this contract."),(0,r.kt)("li",{parentName:"ul"},"The view function does not alter state on the blockchain."),(0,r.kt)("li",{parentName:"ul"},"The function returns a mock ",(0,r.kt)("a",{parentName:"li",href:"/dev/api/data-structures/jbfundingcycle"},(0,r.kt)("inlineCode",{parentName:"a"},"JBFundingCycle"))," of what the next funding cycle will be.")),(0,r.kt)("h4",{id:"body"},"Body"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Save a reference to time at or after which the mock must have started. There are a few possibilities."),(0,r.kt)("ol",{parentName:"li"},(0,r.kt)("li",{parentName:"ol"},"If the call to the function does not allow mid cycle, the start date must be now or in the future. This is also the case if the base funding cycle doesn't have a duration because the next funding cycle can start immediately."),(0,r.kt)("li",{parentName:"ol"},"If neither of these cases apply, moving back one full duration period of the base funding cycle will find the most recent possible start time for the mock cycle to start.")),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre"},"// Get the distance of the current time to the start of the next possible funding cycle.\n// If the returned mock cycle must not yet have started, the start time of the mock must be in the future.\nuint256 _mustStartAtOrAfter = !_allowMidCycle\n  ? block.timestamp + 1\n  : block.timestamp - _baseFundingCycle.duration + 1;\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Find the correct start time for the mock funding cycle."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre"},"// Derive what the start time should be.\nuint256 _start = _deriveStartFrom(_baseFundingCycle, _mustStartAtOrAfter);\n")),(0,r.kt)("p",{parentName:"li"},(0,r.kt)("em",{parentName:"p"},"Internal references:")),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"/dev/api/contracts/jbfundingcyclestore/read/-_derivestartfrom"},(0,r.kt)("inlineCode",{parentName:"a"},"_deriveStartFrom"))))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Find the correct number for the mock funding cycle."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre"},"// Derive what the number should be.\nuint256 _number = _deriveNumberFrom(_baseFundingCycle, _start);\n")),(0,r.kt)("p",{parentName:"li"},(0,r.kt)("em",{parentName:"p"},"Internal references:")),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"/dev/api/contracts/jbfundingcyclestore/read/-_derivenumberfrom"},(0,r.kt)("inlineCode",{parentName:"a"},"_deriveNumberFrom"))))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Return a ",(0,r.kt)("a",{parentName:"p",href:"/dev/api/data-structures/jbfundingcycle"},(0,r.kt)("inlineCode",{parentName:"a"},"JBFundingCycle"))," with the aggregated configuration."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre"},"return\n  JBFundingCycle(\n    _number,\n    _baseFundingCycle.configuration,\n    _baseFundingCycle.basedOn,\n    _start,\n    _baseFundingCycle.duration,\n    _deriveWeightFrom(_baseFundingCycle, _start),\n    _baseFundingCycle.discountRate,\n    _baseFundingCycle.ballot,\n    _baseFundingCycle.metadata\n  );\n")),(0,r.kt)("p",{parentName:"li"},(0,r.kt)("em",{parentName:"p"},"Internal references:")),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"/dev/api/contracts/jbfundingcyclestore/read/-_deriveweightfrom"},(0,r.kt)("inlineCode",{parentName:"a"},"_deriveWeightFrom"))))))),(0,r.kt)(i.Z,{value:"Code",label:"Code",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"/** \n  @notice \n  A view of the funding cycle that would be created based on the provided one if the project doesn't make a reconfiguration.\n\n  @dev\n  Returns an empty funding cycle if there can't be a mock funding cycle based on the provided one.\n\n  @dev\n  Assumes a funding cycle with a duration of 0 will never be asked to be the base of a mock.\n\n  @param _baseFundingCycle The funding cycle that the resulting funding cycle should follow.\n  @param _allowMidCycle A flag indicating if the mocked funding cycle is allowed to already be mid cycle.\n\n  @return A mock of what the next funding cycle will be.\n*/\nfunction _mockFundingCycleBasedOn(JBFundingCycle memory _baseFundingCycle, bool _allowMidCycle)\n  private\n  view\n  returns (JBFundingCycle memory)\n{\n  // Get the distance of the current time to the start of the next possible funding cycle.\n  // If the returned mock cycle must not yet have started, the start time of the mock must be in the future.\n  uint256 _mustStartAtOrAfter = !_allowMidCycle\n    ? block.timestamp + 1\n    : block.timestamp - _baseFundingCycle.duration + 1;\n\n  // Derive what the start time should be.\n  uint256 _start = _deriveStartFrom(_baseFundingCycle, _mustStartAtOrAfter);\n\n  // Derive what the number should be.\n  uint256 _number = _deriveNumberFrom(_baseFundingCycle, _start);\n\n  return\n    JBFundingCycle(\n      _number,\n      _baseFundingCycle.configuration,\n      _baseFundingCycle.basedOn,\n      _start,\n      _baseFundingCycle.duration,\n      _deriveWeightFrom(_baseFundingCycle, _start),\n      _baseFundingCycle.discountRate,\n      _baseFundingCycle.ballot,\n      _baseFundingCycle.metadata\n    );\n}\n"))),(0,r.kt)(i.Z,{value:"Bug bounty",label:"Bug bounty",mdxType:"TabItem"},(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Category"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"),(0,r.kt)("th",{parentName:"tr",align:null},"Reward"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"td"},"Optimization")),(0,r.kt)("td",{parentName:"tr",align:null},"Help make this operation more efficient."),(0,r.kt)("td",{parentName:"tr",align:null},"0.5ETH")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"td"},"Low severity")),(0,r.kt)("td",{parentName:"tr",align:null},"Identify a vulnerability in this operation that could lead to an inconvenience for a user of the protocol or for a protocol developer."),(0,r.kt)("td",{parentName:"tr",align:null},"1ETH")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"td"},"High severity")),(0,r.kt)("td",{parentName:"tr",align:null},"Identify a vulnerability in this operation that could lead to data corruption or loss of funds."),(0,r.kt)("td",{parentName:"tr",align:null},"5+ETH")))))))}p.isMDXComponent=!0}}]);