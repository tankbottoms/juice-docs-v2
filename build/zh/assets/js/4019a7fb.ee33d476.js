"use strict";(self.webpackChunkjuice_docs_v_2=self.webpackChunkjuice_docs_v_2||[]).push([[72999],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>f});var r=n(67294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var c=r.createContext({}),u=function(e){var t=r.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},p=function(e){var t=u(e.components);return r.createElement(c.Provider,{value:t},e.children)},s={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,i=e.originalType,c=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),d=u(n),f=a,m=d["".concat(c,".").concat(f)]||d[f]||s[f]||i;return n?r.createElement(m,o(o({ref:t},p),{},{components:n})):r.createElement(m,o({ref:t},p))}));function f(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=n.length,o=new Array(i);o[0]=d;var l={};for(var c in t)hasOwnProperty.call(t,c)&&(l[c]=t[c]);l.originalType=e,l.mdxType="string"==typeof e?e:a,o[1]=l;for(var u=2;u<i;u++)o[u]=n[u];return r.createElement.apply(null,o)}return r.createElement.apply(null,n)}d.displayName="MDXCreateElement"},85162:(e,t,n)=>{n.d(t,{Z:()=>o});var r=n(67294),a=n(86010);const i="tabItem_Ymn6";function o(e){let{children:t,hidden:n,className:o}=e;return r.createElement("div",{role:"tabpanel",className:(0,a.Z)(i,o),hidden:n},t)}},65488:(e,t,n)=>{n.d(t,{Z:()=>f});var r=n(87462),a=n(67294),i=n(86010),o=n(72389),l=n(67392),c=n(7094),u=n(12466);const p="tabList__CuJ",s="tabItem_LNqP";function d(e){var t,n;const{lazy:o,block:d,defaultValue:f,values:m,groupId:g,className:h}=e,b=a.Children.map(e.children,(e=>{if((0,a.isValidElement)(e)&&"value"in e.props)return e;throw new Error("Docusaurus error: Bad <Tabs> child <"+("string"==typeof e.type?e.type:e.type.name)+'>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.')})),y=null!=m?m:b.map((e=>{let{props:{value:t,label:n,attributes:r}}=e;return{value:t,label:n,attributes:r}})),k=(0,l.l)(y,((e,t)=>e.value===t.value));if(k.length>0)throw new Error('Docusaurus error: Duplicate values "'+k.map((e=>e.value)).join(", ")+'" found in <Tabs>. Every value needs to be unique.');const N=null===f?f:null!=(t=null!=f?f:null==(n=b.find((e=>e.props.default)))?void 0:n.props.value)?t:b[0].props.value;if(null!==N&&!y.some((e=>e.value===N)))throw new Error('Docusaurus error: The <Tabs> has a defaultValue "'+N+'" but none of its children has the corresponding value. Available values are: '+y.map((e=>e.value)).join(", ")+". If you intend to show no default tab, use defaultValue={null} instead.");const{tabGroupChoices:_,setTabGroupChoices:v}=(0,c.U)(),[C,j]=(0,a.useState)(N),I=[],{blockElementScrollPositionUntilNextRender:w}=(0,u.o5)();if(null!=g){const e=_[g];null!=e&&e!==C&&y.some((t=>t.value===e))&&j(e)}const O=e=>{const t=e.currentTarget,n=I.indexOf(t),r=y[n].value;r!==C&&(w(t),j(r),null!=g&&v(g,String(r)))},F=e=>{var t;let n=null;switch(e.key){case"ArrowRight":{var r;const t=I.indexOf(e.currentTarget)+1;n=null!=(r=I[t])?r:I[0];break}case"ArrowLeft":{var a;const t=I.indexOf(e.currentTarget)-1;n=null!=(a=I[t])?a:I[I.length-1];break}}null==(t=n)||t.focus()};return a.createElement("div",{className:(0,i.Z)("tabs-container",p)},a.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,i.Z)("tabs",{"tabs--block":d},h)},y.map((e=>{let{value:t,label:n,attributes:o}=e;return a.createElement("li",(0,r.Z)({role:"tab",tabIndex:C===t?0:-1,"aria-selected":C===t,key:t,ref:e=>I.push(e),onKeyDown:F,onFocus:O,onClick:O},o,{className:(0,i.Z)("tabs__item",s,null==o?void 0:o.className,{"tabs__item--active":C===t})}),null!=n?n:t)}))),o?(0,a.cloneElement)(b.filter((e=>e.props.value===C))[0],{className:"margin-top--md"}):a.createElement("div",{className:"margin-top--md"},b.map(((e,t)=>(0,a.cloneElement)(e,{key:t,hidden:e.props.value!==C})))))}function f(e){const t=(0,o.Z)();return a.createElement(d,(0,r.Z)({key:String(t)},e))}},57329:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>c,default:()=>f,frontMatter:()=>l,metadata:()=>u,toc:()=>s});var r=n(87462),a=(n(67294),n(3905)),i=n(65488),o=n(85162);const l={},c="_configureIntrinsicPropertiesFor",u={unversionedId:"dev/api/contracts/jbfundingcyclestore/write/-_configureintrinsicpropertiesfor",id:"dev/api/contracts/jbfundingcyclestore/write/-_configureintrinsicpropertiesfor",title:"_configureIntrinsicPropertiesFor",description:"Contract: JBFundingCycleStore\u200b",source:"@site/docs/dev/api/contracts/jbfundingcyclestore/write/-_configureintrinsicpropertiesfor.md",sourceDirName:"dev/api/contracts/jbfundingcyclestore/write",slug:"/dev/api/contracts/jbfundingcyclestore/write/-_configureintrinsicpropertiesfor",permalink:"/zh/dev/api/contracts/jbfundingcyclestore/write/-_configureintrinsicpropertiesfor",draft:!1,editUrl:"https://github.com/jbx-protocol/juice-docs-v2/blob/main/docs/dev/api/contracts/jbfundingcyclestore/write/-_configureintrinsicpropertiesfor.md",tags:[],version:"current",frontMatter:{},sidebar:"dev",previous:{title:"queuedOf",permalink:"/zh/dev/api/contracts/jbfundingcyclestore/read/queuedof"},next:{title:"_initFor",permalink:"/zh/dev/api/contracts/jbfundingcyclestore/write/-_initfor"}},p={},s=[{value:"Definition",id:"definition",level:4},{value:"Body",id:"body",level:4}],d={toc:s};function f(e){let{components:t,...n}=e;return(0,a.kt)("wrapper",(0,r.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"_configureintrinsicpropertiesfor"},"_configureIntrinsicPropertiesFor"),(0,a.kt)("p",null,"Contract: ",(0,a.kt)("a",{parentName:"p",href:"/zh/dev/api/contracts/jbfundingcyclestore/"},(0,a.kt)("inlineCode",{parentName:"a"},"JBFundingCycleStore")),"\u200b"),(0,a.kt)(i.Z,{mdxType:"Tabs"},(0,a.kt)(o.Z,{value:"Step by step",label:"Step by step",mdxType:"TabItem"},(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Updates the configurable funding cycle for this project if it exists, otherwise creates one.")),(0,a.kt)("h4",{id:"definition"},"Definition"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"function _configureIntrinsicPropertiesFor(\n  uint256 _projectId,\n  uint256 _configuration,\n  uint256 _weight,\n  uint256 _mustStartAtOrAfter\n) private { ... }\n")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Arguments:",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"_projectId")," is the ID of the project to find a configurable funding cycle for."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"_configuration")," is the time at which the funding cycle was configured."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"_weight")," is the weight to store in the configured funding cycle."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"_mustStartAtOrAfter")," is the time before which the initialized funding cycle can't start."))),(0,a.kt)("li",{parentName:"ul"},"The function is private to this contract."),(0,a.kt)("li",{parentName:"ul"},"The function doesn't return anything.")),(0,a.kt)("h4",{id:"body"},"Body"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"If the project does not yet have a funding cycle, initialize a new one."),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre"},"// If there's not yet a funding cycle for the project, initialize one.\nif (latestConfigurationOf[_projectId] == 0)\n  // Use an empty funding cycle as the base.\n  return\n    _initFor(_projectId, _getStructFor(0, 0), _configuration, _mustStartAtOrAfter, _weight);\n")),(0,a.kt)("p",{parentName:"li"},(0,a.kt)("em",{parentName:"p"},"Internal references:")),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"/zh/dev/api/contracts/jbfundingcyclestore/properties/latestconfigurationof"},(0,a.kt)("inlineCode",{parentName:"a"},"latestConfigurationOf"))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"/zh/dev/api/contracts/jbfundingcyclestore/write/-_initfor"},(0,a.kt)("inlineCode",{parentName:"a"},"_initFor"))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"/zh/dev/api/contracts/jbfundingcyclestore/read/-_getstructfor"},(0,a.kt)("inlineCode",{parentName:"a"},"_getStructFor"))))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"If there's no standby funding cycle, get a reference to the project's eligible funding cycle. The configurable funding cycle will have to be initialized based on the eligible cycle."),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre"},"// Get the active funding cycle's configuration.\nuint256 _currentConfiguration = _eligibleOf(_projectId);\n")),(0,a.kt)("p",{parentName:"li"},(0,a.kt)("em",{parentName:"p"},"Internal references:")),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"/zh/dev/api/contracts/jbfundingcyclestore/read/-_eligibleof"},(0,a.kt)("inlineCode",{parentName:"a"},"_eligibleOf"))))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"If there is no eligible funding cycle for the project, get a reference instead to the project's latest funding cycle configuration, which may have been initialized long into the past."),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre"},"// If an eligible funding cycle does not exist, get a reference to the latest funding cycle configuration for the project.\nif (_currentConfiguration == 0)\n  // Get the latest funding cycle's configuration.\n  _currentConfiguration = latestConfigurationOf[_projectId];\n")),(0,a.kt)("p",{parentName:"li"},(0,a.kt)("em",{parentName:"p"},"Internal references:")),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"/zh/dev/api/contracts/jbfundingcyclestore/properties/latestconfigurationof"},(0,a.kt)("inlineCode",{parentName:"a"},"latestConfigurationOf"))))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Resolve the funding cycle struct for the currently referenced configuration."),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre"},"// Get a reference to the funding cycle.\nJBFundingCycle memory _baseFundingCycle = _getStructFor(_projectId, _currentConfiguration);\n")),(0,a.kt)("p",{parentName:"li"},(0,a.kt)("em",{parentName:"p"},"Internal references:")),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"/zh/dev/api/contracts/jbfundingcyclestore/read/-_getstructfor"},(0,a.kt)("inlineCode",{parentName:"a"},"_getStructFor"))))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"If the configuration isn't approved, get a reference to the configuration it's based on which must be the latest approved configuration."),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre"},"if (!_isApproved(_projectId, _baseFundingCycle) || block.timestamp < _baseFundingCycle.start)\n  // If it hasn't been approved or hasn't yet started, set the ID to be the funding cycle it's based on,\n  // which carries the latest approved configuration.\n  _baseFundingCycle = _getStructFor(_projectId, _baseFundingCycle.basedOn;\n")),(0,a.kt)("p",{parentName:"li"},(0,a.kt)("em",{parentName:"p"},"Internal references:")),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"/zh/dev/api/contracts/jbfundingcyclestore/read/-_isapproved"},(0,a.kt)("inlineCode",{parentName:"a"},"_isApproved"))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"/zh/dev/api/contracts/jbfundingcyclestore/read/-_getstructfor"},(0,a.kt)("inlineCode",{parentName:"a"},"_getStructFor"))))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Make sure the configuration isn't the same as the base configuration. Only one configuration can be made to a project's funding cycles per block. "),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre"},"// The configuration can't be the same as the base configuration.\nif (_baseFundingCycle.configuration == _configuration) revert NO_SAME_BLOCK_RECONFIGURATION();\n"))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Get a reference to the time after which the base funding cycle's ballot will be resolved. The funding cycle that will be initialized can start any time after the base funding cycle's ballot's duration is up."),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre"},"// The time after the ballot of the provided funding cycle has expired.\n// If the provided funding cycle has no ballot, return the current timestamp.\nuint256 _timestampAfterBallot = _baseFundingCycle.ballot == IJBFundingCycleBallot(address(0))\n  ? 0\n  : _configuration + _baseFundingCycle.ballot.duration();\n")),(0,a.kt)("p",{parentName:"li"},(0,a.kt)("em",{parentName:"p"},"Internal references:")),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"/zh/dev/api/interfaces/ijbfundingcycleballot"},(0,a.kt)("inlineCode",{parentName:"a"},"duration"))))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Initialize a funding cycle with the correct configuration. Make sure it can only start after the base cycle's ballot has resolved."),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre"},"_initFor(\n  _projectId,\n  _baseFundingCycle,\n  _configuration,\n  // Can only start after the ballot.\n  _timestampAfterBallot > _mustStartAtOrAfter ? _timestampAfterBallot : _mustStartAtOrAfter,\n  _weight\n);\n")),(0,a.kt)("p",{parentName:"li"},(0,a.kt)("em",{parentName:"p"},"Internal references:")),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"/zh/dev/api/contracts/jbfundingcyclestore/write/-_initfor"},(0,a.kt)("inlineCode",{parentName:"a"},"_initFor"))))))),(0,a.kt)(o.Z,{value:"Code",label:"Code",mdxType:"TabItem"},(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"/**\n  @notice \n  Updates the configurable funding cycle for this project if it exists, otherwise creates one.\n\n  @param _projectId The ID of the project to find a configurable funding cycle for.\n  @param _configuration The time at which the funding cycle was configured.\n  @param _weight The weight to store in the configured funding cycle.\n  @param _mustStartAtOrAfter The time before which the initialized funding cycle can't start.\n*/\nfunction _configureIntrinsicPropertiesFor(\n  uint256 _projectId,\n  uint256 _configuration,\n  uint256 _weight,\n  uint256 _mustStartAtOrAfter\n) private {\n  // If there's not yet a funding cycle for the project, initialize one.\n  if (latestConfigurationOf[_projectId] == 0)\n    // Use an empty funding cycle as the base.\n    return\n      _initFor(_projectId, _getStructFor(0, 0), _configuration, _mustStartAtOrAfter, _weight);\n\n  // Get the active funding cycle's configuration.\n  uint256 _currentConfiguration = _eligibleOf(_projectId);\n\n  // If an eligible funding cycle does not exist, get a reference to the latest funding cycle configuration for the project.\n  if (_currentConfiguration == 0)\n    // Get the latest funding cycle's configuration.\n    _currentConfiguration = latestConfigurationOf[_projectId];\n\n  // Get a reference to the funding cycle.\n  JBFundingCycle memory _baseFundingCycle = _getStructFor(_projectId, _currentConfiguration);\n\n  if (!_isApproved(_projectId, _baseFundingCycle) || block.timestamp < _baseFundingCycle.start)\n    // If it hasn't been approved or hasn't yet started, set the ID to be the funding cycle it's based on,\n    // which carries the latest approved configuration.\n    _baseFundingCycle = _getStructFor(_projectId, _baseFundingCycle.basedOn);\n\n  // The configuration can't be the same as the base configuration.\n  if (_baseFundingCycle.configuration == _configuration) revert NO_SAME_BLOCK_RECONFIGURATION();\n\n  // The time after the ballot of the provided funding cycle has expired.\n  // If the provided funding cycle has no ballot, return the current timestamp.\n  uint256 _timestampAfterBallot = _baseFundingCycle.ballot == IJBFundingCycleBallot(address(0))\n    ? 0\n    : _configuration + _baseFundingCycle.ballot.duration();\n\n  _initFor(\n    _projectId,\n    _baseFundingCycle,\n    _configuration,\n    // Can only start after the ballot.\n    _timestampAfterBallot > _mustStartAtOrAfter ? _timestampAfterBallot : _mustStartAtOrAfter,\n    _weight\n  );\n}\n"))),(0,a.kt)(o.Z,{value:"Errors",label:"Errors",mdxType:"TabItem"},(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"String"),(0,a.kt)("th",{parentName:"tr",align:null},"Description"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("strong",{parentName:"td"},(0,a.kt)("inlineCode",{parentName:"strong"},"NO_SAME_BLOCK_RECONFIGURATION"))),(0,a.kt)("td",{parentName:"tr",align:null},"Thrown if two configurations have been submitted in the same block."))))),(0,a.kt)(o.Z,{value:"Bug bounty",label:"Bug bounty",mdxType:"TabItem"},(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"Category"),(0,a.kt)("th",{parentName:"tr",align:null},"Description"),(0,a.kt)("th",{parentName:"tr",align:null},"Reward"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("strong",{parentName:"td"},"Optimization")),(0,a.kt)("td",{parentName:"tr",align:null},"Help make this operation more efficient."),(0,a.kt)("td",{parentName:"tr",align:null},"0.5ETH")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("strong",{parentName:"td"},"Low severity")),(0,a.kt)("td",{parentName:"tr",align:null},"Identify a vulnerability in this operation that could lead to an inconvenience for a user of the protocol or for a protocol developer."),(0,a.kt)("td",{parentName:"tr",align:null},"1ETH")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("strong",{parentName:"td"},"High severity")),(0,a.kt)("td",{parentName:"tr",align:null},"Identify a vulnerability in this operation that could lead to data corruption or loss of funds."),(0,a.kt)("td",{parentName:"tr",align:null},"5+ETH")))))))}f.isMDXComponent=!0}}]);